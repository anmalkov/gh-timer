#!/bin/bash
set -e

seconds=0
while [ $# -gt 0 ]; do
  case "$1" in
  -s|--sec)
    seconds=$2
    ;;
  -m|--min)
    seconds=$(($2*60))
    ;;
  -h|--help)
    echo "Run a timer or stopwatch.

gh timer [units] [number]

[units]
  -s, --sec : seconds 
  -m, --min : minutes

Examples:

gh timer --sec 30
    run stopwatch for 30 seconds

gh timer --min 5
    run stopwatch for 5 minutes"
    exit 0
    ;;
  esac
  shift
done

show_clock () {
    local hours=$1
    local minutes=$2
    local seconds=$3
    echo -ne "$hours:$minutes:$seconds\r"
}

date1=$(date +%s)

while ! [ $(( $(date +%s) - $date1 )) -ge $seconds ]; do
    show_clock "$(date -u --date @$(( $(date +%s) - $date1 )) +%H)" "$(date -u --date @$(( $(date +%s) - $date1 )) +%M)" "$(date -u --date @$(( $(date +%s) - $date1 )) +%S)"
done

